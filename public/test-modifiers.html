<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Elemental Modifiers</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 20px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .test-pass {
            background-color: #2d5a3d;
            border: 1px solid #4a7c59;
        }
        .test-fail {
            background-color: #5a2d2d;
            border: 1px solid #7c4a4a;
        }
        button {
            background-color: #4a7c59;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #5a8b69;
        }
        .stats-display {
            background-color: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-family: monospace;
            font-size: 12px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        .stats-table th, .stats-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #555;
            vertical-align: top;
        }
        .stats-table th {
            background-color: #444;
            font-weight: bold;
            color: #fff;
            position: sticky;
            top: 0;
        }
        .stats-table tr:hover {
            background-color: #3a3a3a;
        }
        .ability-name {
            font-weight: bold;
            color: #4a7c59;
        }
        .base-value {
            color: #888;
        }
        .modified-value {
            color: #4a7c59;
            font-weight: bold;
        }
        .calculation {
            color: #ccc;
            font-size: 11px;
        }
        .element-header {
            background-color: #2a4a2a !important;
            color: #fff;
        }
        .unavailable {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üß™ Elemental Modifiers Test Suite</h1>
    <p>Testing the new elemental modifier system locally before deployment</p>
    
    <div class="test-section">
        <h2>üîß Setup Test Player</h2>
        <button onclick="createTestPlayer()">Create Test Player</button>
        <button onclick="levelUp('fire')">üî• Level Fire</button>
        <button onclick="levelUp('water')">üíß Level Water</button>
        <button onclick="levelUp('earth')">üåç Level Earth</button>
        <button onclick="levelUp('lightning')">‚ö° Level Lightning</button>
        <button onclick="levelUp('air')">üå™Ô∏è Level Air</button>
        <button onclick="resetPlayer()">üîÑ Reset</button>
        
        <div style="margin-top: 15px; padding: 10px; background-color: #2a4a2a; border-radius: 5px; font-size: 12px;">
            <strong>üìã Progression Rules:</strong><br>
            ‚Ä¢ <strong>Maximum 3 elements</strong> can reach Level 5<br>
            ‚Ä¢ <strong>Only 2 of those 3</strong> can go beyond Level 5 (Ultimate Mastery)<br>
            ‚Ä¢ <strong>Levels 6-10</strong> are reserved for your 2 chosen Ultimate elements<br>
            ‚Ä¢ Buttons will be disabled when caps are reached
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìä Global Modifiers</h2>
        <div id="globalModifiers" class="stats-display">
            No player created yet
        </div>
    </div>

    <div class="test-section">
        <h2>üéØ Weapon & Ability Stats Breakdown</h2>
        <div id="detailedStats">
            No player created yet
        </div>
    </div>
    
    <div class="test-section">
        <h2>üß™ Test Results</h2>
        <button onclick="runAllTests()">Run All Tests</button>
        <div id="testResults"></div>
    </div>

    <script type="module">
        import { PLAYER_CONFIG } from './js/utils/Constants.js';
        import { ElementalModifiers } from './js/systems/ElementalModifiers.js';
        
        // Mock player for testing
        let testPlayer = null;
        
        window.createTestPlayer = function() {
            testPlayer = {
                upgradeCount: {
                    fire: 0,
                    water: 0,
                    earth: 0,
                    lightning: 0,
                    air: 0
                },
                elementalModifiers: null
            };
            testPlayer.elementalModifiers = new ElementalModifiers(testPlayer);
            updateStatsDisplay();
        };
        
        window.levelUp = function(element) {
            if (!testPlayer) {
                alert('Create test player first!');
                return;
            }
            
            const currentLevel = testPlayer.upgradeCount[element] || 0;
            const elementsAtLevel5Plus = Object.values(testPlayer.upgradeCount).filter(level => level >= 5).length;
            const elementsAtLevel6Plus = Object.values(testPlayer.upgradeCount).filter(level => level >= 6).length;
            const elementsAtLevel5 = Object.values(testPlayer.upgradeCount).filter(level => level === 5).length;
            
            // Check level caps based on progression rules
            if (currentLevel >= 10) {
                alert(`${element.charAt(0).toUpperCase() + element.slice(1)} is already at max level (10)!`);
                return;
            }
            
            // Rule 1: Can't have more than 3 elements at level 5+
            if (currentLevel === 4 && elementsAtLevel5Plus >= 3) {
                alert('Maximum 3 elements can reach level 5! Choose your elements wisely.');
                return;
            }
            
            // Rule 2: Can't have more than 2 elements at level 6+ 
            if (currentLevel === 5 && elementsAtLevel6Plus >= 2) {
                alert('Only 2 elements can go beyond level 5 (Ultimate Mastery)! Choose your ultimate elements wisely.');
                return;
            }
            
            // Rule 3: Can't go past level 5 without being one of the 2 ultimate elements
            if (currentLevel >= 6) {
                const ultimateElements = Object.entries(testPlayer.upgradeCount)
                    .filter(([_, level]) => level >= 6)
                    .map(([el, _]) => el);
                    
                if (!ultimateElements.includes(element) && ultimateElements.length >= 2) {
                    alert('This element is not one of your 2 chosen Ultimate Mastery elements!');
                    return;
                }
            }
            
            testPlayer.upgradeCount[element]++;
            updateStatsDisplay();
            updateLevelButtons();
        };
        
        window.resetPlayer = function() {
            if (!testPlayer) return;
            testPlayer.upgradeCount = {
                fire: 0, water: 0, earth: 0, lightning: 0, air: 0
            };
            updateStatsDisplay();
            updateLevelButtons();
        };
        
        function updateLevelButtons() {
            if (!testPlayer) return;
            
            const elementsAtLevel5Plus = Object.values(testPlayer.upgradeCount).filter(level => level >= 5).length;
            const elementsAtLevel6Plus = Object.values(testPlayer.upgradeCount).filter(level => level >= 6).length;
            const ultimateElements = Object.entries(testPlayer.upgradeCount)
                .filter(([_, level]) => level >= 6)
                .map(([el, _]) => el);
            
            ['fire', 'water', 'earth', 'lightning', 'air'].forEach(element => {
                const button = document.querySelector(`button[onclick="levelUp('${element}')"]`);
                if (!button) return;
                
                const currentLevel = testPlayer.upgradeCount[element] || 0;
                let disabled = false;
                let reason = '';
                
                if (currentLevel >= 10) {
                    disabled = true;
                    reason = 'Max Level';
                } else if (currentLevel === 4 && elementsAtLevel5Plus >= 3) {
                    disabled = true;
                    reason = 'Max 3 at Level 5+';
                } else if (currentLevel === 5 && elementsAtLevel6Plus >= 2) {
                    disabled = true;
                    reason = 'Max 2 Ultimate';
                } else if (currentLevel >= 6 && !ultimateElements.includes(element) && ultimateElements.length >= 2) {
                    disabled = true;
                    reason = 'Not Ultimate';
                }
                
                button.disabled = disabled;
                button.style.opacity = disabled ? '0.5' : '1';
                button.title = disabled ? reason : `Level up ${element}`;
                
                // Update button text to show current level
                const icon = button.textContent.split(' ')[0];
                button.textContent = `${icon} Level ${element.charAt(0).toUpperCase() + element.slice(1)} (${currentLevel})`;
            });
        }
        
        function updateStatsDisplay() {
            if (!testPlayer) {
                document.getElementById('globalModifiers').innerHTML = 'No player created yet';
                document.getElementById('detailedStats').innerHTML = 'No player created yet';
                return;
            }
            
            const modifiers = testPlayer.elementalModifiers.getModifiers();
            const levels = testPlayer.upgradeCount;
            
            // Update global modifiers display
            document.getElementById('globalModifiers').innerHTML = `
<table class="stats-table" style="margin-bottom: 15px;">
    <thead>
        <tr>
            <th>Element</th>
            <th>Level</th>
            <th>Bonus Type</th>
            <th>Effect</th>
            <th>Multiplier</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="ability-name">üî• Fire</td>
            <td class="modified-value">${levels.fire}</td>
            <td>Damage</td>
            <td class="modified-value">+${((modifiers.damageMultiplier - 1) * 100).toFixed(0)}%</td>
            <td class="calculation">${modifiers.damageMultiplier.toFixed(2)}x</td>
        </tr>
        <tr>
            <td class="ability-name">üåç Earth</td>
            <td class="modified-value">${levels.earth}</td>
            <td>Radius/AoE</td>
            <td class="modified-value">+${((modifiers.radiusMultiplier - 1) * 100).toFixed(0)}%</td>
            <td class="calculation">${modifiers.radiusMultiplier.toFixed(2)}x</td>
        </tr>
        <tr>
            <td class="ability-name">üå™Ô∏è Air</td>
            <td class="modified-value">${levels.air}</td>
            <td>Range</td>
            <td class="modified-value">+${((modifiers.rangeMultiplier - 1) * 100).toFixed(0)}%</td>
            <td class="calculation">${modifiers.rangeMultiplier.toFixed(2)}x</td>
        </tr>
        <tr>
            <td class="ability-name">‚ö° Lightning</td>
            <td class="modified-value">${levels.lightning}</td>
            <td>Attack Speed</td>
            <td class="modified-value">+${((1/modifiers.attackSpeedMultiplier - 1) * 100).toFixed(0)}%</td>
            <td class="calculation">${modifiers.attackSpeedMultiplier.toFixed(2)}x cooldown</td>
        </tr>
        <tr>
            <td class="ability-name">üíß Water</td>
            <td class="modified-value">${levels.water}</td>
            <td>Health</td>
            <td class="modified-value">+${((modifiers.healthMultiplier - 1) * 100).toFixed(0)}%</td>
            <td class="calculation">${modifiers.healthMultiplier.toFixed(2)}x</td>
        </tr>
        <tr>
            <td class="ability-name">üíß Water</td>
            <td class="modified-value">${levels.water}</td>
            <td>Regeneration</td>
            <td class="modified-value">+${modifiers.healthRegenPerSecond}/sec</td>
            <td class="calculation">N/A</td>
        </tr>
    </tbody>
</table>
            `;
            
            // Update detailed stats table
            updateDetailedStatsTable();
        }
        
        function updateDetailedStatsTable() {
            if (!testPlayer) return;
            
            const modifiers = testPlayer.elementalModifiers.getModifiers();
            const levels = testPlayer.upgradeCount;
            
            // Define all weapons and abilities with their base stats
            const weapons = [
                {
                    name: "üéØ Basic Weapon",
                    base: { damage: 20, range: 200, cooldown: 0.5, radius: 3 },
                    type: 'weapon',
                    available: true,
                    description: "Primary projectile attack"
                },
                {
                    name: "üî• Fireball",
                    base: { damage: 30, range: 200, cooldown: 2.0, radius: 25 },
                    type: 'ability',
                    available: levels.fire >= 1,
                    description: "Explosive projectile (Level 1+)",
                    damageCalc: "Base √ó Fire Damage Bonus",
                    radiusCalc: "Base √ó Earth Radius Bonus",
                    rangeCalc: "Base √ó Air Range Bonus", 
                    cooldownCalc: "Base √ó Lightning Speed Multiplier"
                },
                {
                    name: "üåã Inferno Wave",
                    base: { damage: 12, range: 0, cooldown: 0, radius: 200 }, // 20 * 0.6 = 12 base damage
                    type: 'ultimate',
                    available: levels.fire >= 6,
                    description: "Chain explosions from fireballs (Level 6+)",
                    note: "Triggers automatically from fireballs"
                },
                {
                    name: "üíß Water Globes",
                    base: { damage: 15, range: 0, cooldown: 0, radius: 5, orbitRadius: 45, rotationSpeed: 0.02 },
                    type: 'ability',
                    available: levels.water >= 1,
                    description: "Orbiting defensive globes (Per Water Level)",
                    count: levels.water,
                    note: "Damage now modified by Fire! Rotation speed modified by Lightning!"
                },
                {
                    name: "üåç Tremors", 
                    base: { damage: 7, range: 0, cooldown: 0.5, radius: 80 },
                    type: 'ability',
                    available: levels.earth >= 1,
                    description: "Pulsing damage around player (Level 1+)"
                },
                {
                    name: "üåç Earthquake Stomp",
                    base: { damage: 100, range: 0, cooldown: 8.0, radius: 150 },
                    type: 'ultimate', 
                    available: levels.earth >= 6,
                    description: "Massive AoE stun attack (Level 6+)"
                },
                {
                    name: "üå™Ô∏è Wind Blades",
                    base: { damage: 16, range: 200, cooldown: 0.5, radius: 6 }, // 20 * 0.8 = 16
                    type: 'ability',
                    available: levels.air >= 1,
                    description: "Seeking projectiles",
                    count: Math.min(levels.air, 5),
                    note: "Count = Air Level (max 5)"
                },
                {
                    name: "üå™Ô∏è Tornado Vortex", 
                    base: { damage: 45, range: 0, cooldown: 2.5, radius: 35 },
                    type: 'ultimate',
                    available: levels.air >= 6,
                    description: "Moving tornado spawner (Level 6+)"
                },
                {
                    name: "‚ö° Chain Lightning",
                    base: { damage: 30, range: 150, cooldown: 2.0, radius: 0 },
                    type: 'ability', 
                    available: levels.lightning >= 1,
                    description: "Multi-target lightning (Level 1+)",
                    count: 1 + levels.lightning,
                    note: "Target count = 1 + Lightning Level"
                },
                {
                    name: "‚ö° Thunder Storm",
                    base: { damage: 60, range: 0, cooldown: 6.0, radius: 200, strikeRadius: 40 },
                    type: 'ultimate',
                    available: levels.lightning >= 6,
                    description: "8 targeted lightning strikes (Level 6+)"
                }
            ];
            
            let tableHTML = `
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th style="min-width: 150px;">Weapon/Ability</th>
                            <th style="min-width: 120px;">üî• Damage</th>
                            <th style="min-width: 120px;">üå™Ô∏è Range</th>
                            <th style="min-width: 120px;">‚ö° Attack Speed</th>
                            <th style="min-width: 120px;">üåç Radius/AoE</th>
                            <th style="min-width: 150px;">Special</th>
                            <th style="min-width: 200px;">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            weapons.forEach(weapon => {
                if (!weapon.available) {
                    // Show unavailable abilities in gray
                    tableHTML += `
                        <tr>
                            <td class="ability-name unavailable">${weapon.name}</td>
                            <td class="unavailable" colspan="6">${weapon.description}</td>
                        </tr>
                    `;
                    return;
                }
                
                const modified = testPlayer.elementalModifiers.getModifiedAbilityStats(weapon.base);
                const weaponMod = testPlayer.elementalModifiers.getModifiedWeaponStats(weapon.base);
                
                // Use weapon stats for basic weapon and wind blades, ability stats for others
                const stats = (weapon.name.includes('Basic Weapon') || weapon.name.includes('Wind Blades')) ? weaponMod : modified;
                
                const damageChange = stats.damage - weapon.base.damage;
                const rangeChange = (stats.range || weapon.base.range) - weapon.base.range;
                const cooldownChange = (stats.cooldown || weapon.base.cooldown) - weapon.base.cooldown;
                const radiusChange = (stats.radius || weapon.base.radius) - weapon.base.radius;
                
                let specialInfo = '';
                if (weapon.count !== undefined) {
                    specialInfo = `Count: <span class="modified-value">${weapon.count}</span>`;
                } else if (weapon.base.orbitRadius) {
                    const modifiedOrbit = weapon.base.orbitRadius + (levels.water * 5);
                    const baseRotationSpeed = weapon.base.rotationSpeed || 0.02;
                    const modifiedRotationSpeed = baseRotationSpeed / modifiers.attackSpeedMultiplier;
                    specialInfo = `Orbit: <span class="modified-value">${modifiedOrbit}px</span> <span class="calculation">(45 + ${levels.water}√ó5)</span><br>Rotation: <span class="modified-value">${modifiedRotationSpeed.toFixed(4)}/frame</span> <span class="calculation">(${baseRotationSpeed} √∑ ${modifiers.attackSpeedMultiplier.toFixed(2)})</span>`;
                }
                
                if (weapon.base.strikeRadius) {
                    const modifiedStrikeRadius = weapon.base.strikeRadius * modifiers.radiusMultiplier;
                    specialInfo += `Strike R: <span class="modified-value">${modifiedStrikeRadius.toFixed(1)}px</span>`;
                }
                
                const dpsInfo = weapon.name.includes('Wind Blades') && weapon.count > 0 ? 
                    `<br><span class="calculation">DPS: ${Math.floor(weapon.count * stats.damage / stats.cooldown)}</span>` : '';
                
                tableHTML += `
                    <tr>
                        <td class="ability-name">${weapon.name}</td>
                        <td>
                            <span class="base-value">${weapon.base.damage}</span> ‚Üí 
                            <span class="modified-value">${stats.damage}</span>
                            <span class="calculation">(${damageChange >= 0 ? '+' : ''}${damageChange})</span>
                        </td>
                        <td>
                            ${weapon.base.range > 0 ? `
                                <span class="base-value">${weapon.base.range}</span> ‚Üí 
                                <span class="modified-value">${Math.floor(stats.range || weapon.base.range)}</span>
                                <span class="calculation">(${rangeChange >= 0 ? '+' : ''}${rangeChange})</span>
                            ` : '<span class="unavailable">N/A</span>'}
                        </td>
                        <td>
                            ${weapon.base.cooldown > 0 ? `
                                <span class="base-value">${weapon.base.cooldown}s</span> ‚Üí 
                                <span class="modified-value">${(stats.cooldown || weapon.base.cooldown).toFixed(2)}s</span>
                                <span class="calculation">(${cooldownChange.toFixed(2)}s)</span>
                            ` : weapon.base.rotationSpeed ? `
                                <span class="base-value">${weapon.base.rotationSpeed}/frame</span> ‚Üí 
                                <span class="modified-value">${(weapon.base.rotationSpeed / modifiers.attackSpeedMultiplier).toFixed(4)}/frame</span>
                                <span class="calculation">(√∑${modifiers.attackSpeedMultiplier.toFixed(2)})</span>
                            ` : '<span class="unavailable">N/A</span>'}
                        </td>
                        <td>
                            <span class="base-value">${weapon.base.radius}</span> ‚Üí 
                            <span class="modified-value">${(stats.radius || weapon.base.radius).toFixed(1)}</span>
                            <span class="calculation">(+${radiusChange.toFixed(1)})</span>
                            ${specialInfo ? `<br>${specialInfo}` : ''}
                        </td>
                        <td>${specialInfo}${dpsInfo}</td>
                        <td>
                            <span style="font-size: 11px;">${weapon.description}</span>
                            ${weapon.note ? `<br><span class="calculation">${weapon.note}</span>` : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <div style="margin-top: 15px; font-size: 12px; color: #888;">
                    <strong>üìê Calculation Formulas:</strong><br>
                    üî• <strong>Fire:</strong> Damage = Base √ó ${modifiers.damageMultiplier.toFixed(2)} (affects ALL damage sources)<br>
                    üåç <strong>Earth:</strong> Radius = Base √ó ${modifiers.radiusMultiplier.toFixed(2)} (affects ALL area effects)<br>
                    üå™Ô∏è <strong>Air:</strong> Range = Base √ó ${modifiers.rangeMultiplier.toFixed(2)} (affects projectile range)<br>
                    ‚ö° <strong>Lightning:</strong> Cooldown = Base √ó ${modifiers.attackSpeedMultiplier.toFixed(2)} (faster = lower cooldown)<br>
                    üíß <strong>Water:</strong> Health = Base √ó ${modifiers.healthMultiplier.toFixed(2)} + ${modifiers.healthRegenPerSecond}/sec regen
                </div>
            `;
            
            document.getElementById('detailedStats').innerHTML = tableHTML;
        }
        
        window.runAllTests = function() {
            if (!testPlayer) {
                alert('Create test player first!');
                return;
            }
            
            let results = '';
            let passCount = 0;
            let totalTests = 0;
            
            function test(name, condition) {
                totalTests++;
                const pass = condition();
                if (pass) passCount++;
                results += `
                    <div class="test-result ${pass ? 'test-pass' : 'test-fail'}">
                        ${pass ? '‚úÖ' : '‚ùå'} ${name}
                    </div>
                `;
                return pass;
            }
            
            // Reset for consistent testing
            resetPlayer();
            
            // Realistic Progression Test: Fire 5, Lightning 7, Water 3 (2 ultimate elements)
            // This follows the rule: 3 elements can reach level 5, then 2 can go beyond
            testPlayer.upgradeCount.fire = 5;
            testPlayer.upgradeCount.lightning = 7;  // Ultimate element
            testPlayer.upgradeCount.water = 3;
            
            // Test Fire Level 5
            const fireModifiers = testPlayer.elementalModifiers.getModifiers();
            test('Fire Level 5 = +50% Damage', () => 
                Math.abs(fireModifiers.damageMultiplier - 1.5) < 0.01
            );
            
            // Test Lightning Level 7 (Ultimate)
            const lightningModifiers = testPlayer.elementalModifiers.getModifiers();
            test('Lightning Level 7 = 52% faster attack (0.478x cooldown)', () => 
                Math.abs(lightningModifiers.attackSpeedMultiplier - Math.pow(0.9, 7)) < 0.01
            );
            
            // Test Water Level 3
            const waterModifiers = testPlayer.elementalModifiers.getModifiers();
            test('Water Level 3 = +30% Health + 3 HP/sec Regen', () => 
                Math.abs(waterModifiers.healthMultiplier - 1.3) < 0.01 && waterModifiers.healthRegenPerSecond === 3
            );
            
            // Test Combined Stats with Realistic Build
            const weaponStats = testPlayer.elementalModifiers.getModifiedWeaponStats({
                damage: 20, range: 200, cooldown: 0.5, radius: 3
            });
            
            test('Realistic Build - Damage: 20 ‚Üí 30 (Fire 5)', () => 
                weaponStats.damage === 30 // 20 * 1.5 = 30
            );
            test('Realistic Build - Range: unchanged (no Air)', () => 
                weaponStats.range === 200 // No Air mastery
            );
            test('Realistic Build - Attack Speed: 0.5s ‚Üí 0.239s (Lightning 7)', () => 
                Math.abs(weaponStats.cooldown - (0.5 * Math.pow(0.9, 7))) < 0.001
            );
            test('Realistic Build - Radius: unchanged (no Earth)', () => 
                Math.abs(weaponStats.radius - 3.0) < 0.01 // No Earth mastery
            );
            
            // Test Ultimate Progression Cap
            resetPlayer();
            testPlayer.upgradeCount.fire = 5;
            testPlayer.upgradeCount.water = 5;
            testPlayer.upgradeCount.earth = 5;
            // Now we have 3 elements at level 5, which is the maximum
            
            const threeCappedModifiers = testPlayer.elementalModifiers.getModifiers();
            test('3-Element Cap: Fire 5 + Water 5 + Earth 5', () => 
                Math.abs(threeCappedModifiers.damageMultiplier - 1.5) < 0.01 &&
                Math.abs(threeCappedModifiers.healthMultiplier - 1.5) < 0.01 &&
                Math.abs(threeCappedModifiers.radiusMultiplier - 1.5) < 0.01
            );
            
            results = `
                <h3>Test Results: ${passCount}/${totalTests} passed</h3>
                ${results}
                ${passCount === totalTests ? 
                    '<div class="test-result test-pass">üéâ All tests passed! System ready for deployment.</div>' :
                    '<div class="test-result test-fail">‚ö†Ô∏è Some tests failed. Check implementation.</div>'
                }
            `;
            
            document.getElementById('testResults').innerHTML = results;
            updateStatsDisplay();
        };
        
        // Auto-create player on load and update display
        createTestPlayer();
        updateStatsDisplay();
        updateLevelButtons();
    </script>
</body>
</html>